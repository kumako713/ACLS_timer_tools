<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ACLS Timer Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .center-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .button-group {
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .selected {
      background-color: black !important;
      color: white !important;
    }
    .red { background-color: #e53935; color: white; }
    .darkred { background-color: #8B0000; color: white; }
    .yellow { background-color: #fbc02d; color: black; }
    .green { background-color: #40e0d0; color: black; }
    .blue { background-color: #4fc3f7; color: black; }
    .gray { background-color: #b0bec5; color: black; }
    .shoke { background-color: #e53935; color: yellow; font-weight: bold; }
    #log {
      margin-top: 20px;
      white-space: pre-line;
      border-top: 1px solid #ccc;
      padding-top: 10px;
      max-width: 1000px;
      text-align: left;
    }
    #countInfo, #clock {
      font-size: 18px;
      color: #333;
    }
    .input-label {
      font-size: 16px;
      margin-left: 10px;
    }
  </style>
</head>
<body>

<!-- 第一列：標題 -->
<div class="center-row">
  <div class="header-text" style="font-size:32px; background-color:#e53935; color:white; padding:10px 20px; border-radius:8px;">ACLS Timer Tool</div>
</div>

<!-- 第二列：現在時間 -->
<div class="center-row">
  <div id="clock"></div>
</div>

<!-- 第三列：性別與年齡 -->
<div class="center-row">
  <button class="gray" id="maleBtn" onclick="toggleGender('male')">Male</button>
  <button class="gray" id="femaleBtn" onclick="toggleGender('female')">Female</button>
  <input type="number" id="ageInput" placeholder="" style="width:60px; font-size:14px; padding:4px;" />
  <span class="input-label">years old</span>
</div>

<!-- 第四列：給藥與電擊次數 -->
<div class="center-row" id="countInfo">
  Epi: <span id="epiCount">0</span> |
  Amio: <span id="amioCount">0</span> |
  Lido: <span id="lidoCount">0</span> |
  Shock: <span id="shockCount">0</span>
</div>

<!-- 第五列：操作按鈕 CPR 等 -->
<div class="center-row">
  <button class="red" onclick="startCPR()">CPR</button>
  <button class="red" onclick="aedAnalyze()">AED Analyze</button>
  <button class="red" onclick="switchCPR()">Switch CPR</button>
  <button class="shoke" onclick="recordShock()">Shock!</button>
  <button class="darkred" onclick="stopCPR()">Stop CPR</button>
</div>

<!-- 同列：藥物按鈕 -->
<div class="center-row">
  <button class="yellow" onclick="giveEpinephrine()">Epi</button>
  <button class="yellow" id="amioBtn" onclick="giveAmiodarone()">Amio</button>
  <button class="yellow" id="lidoBtn" onclick="giveLidocaine()">Lido</button>
</div>

<!-- 同列：IV IO Endo -->
<div class="center-row">
  <button class="green" onclick="recordEvent('IV')">IV</button>
  <button class="green" onclick="recordEvent('IO')">IO</button>
  <button class="green" onclick="recordEndoTube()">Endo</button>
</div>

<!-- ROSC與Reset -->
<div class="center-row">
  <button class="blue" onclick="recordEvent('ROSC')">ROSC</button>
  <button class="gray" onclick="resetLog()">Reset</button>
</div>

<div id="log"></div>

<script>
let startTime = null;
let epiCount = 0, amioCount = 0, lidoCount = 0, shockCount = 0;
let timers = [];

function updateClock() {
  document.getElementById("clock").innerText = "當前時間：" + new Date().toLocaleString();
}
setInterval(updateClock, 1000); updateClock();

function getCurrentTimeStr() {
  const now = new Date();
  return now.toLocaleTimeString();
}

function recordEvent(event) {
  const now = new Date();
  if (!startTime) startTime = now;
  const elapsed = Math.floor((now - startTime) / 1000);
  const log = document.getElementById("log");
  log.innerText += `[${Math.floor(elapsed/60).toString().padStart(2,'0')}:${(elapsed%60).toString().padStart(2,'0')}] ${event} - ${now.toLocaleTimeString()}\n`;
}

function startCPR() {
  recordEvent("CPR 開始");
  if (!startTime) startTime = new Date();
  timers.push(setTimeout(() => alert("30秒心律分析"), 90000));
  timers.push(setTimeout(() => alert("10秒心律分析"), 110000));
  timers.push(setInterval(() => alert("提醒：CPR 執行中，請考慮 5H5T？"), 120000));
}
function stopCPR() {
  recordEvent("CPR 停止");
  timers.forEach(t => clearTimeout(t) || clearInterval(t));
  timers = [];
}
function aedAnalyze() {
  recordEvent("AED 分析開始（倒數 10 秒）");
  setTimeout(() => recordEvent("AED 分析結束"), 10000);
}
function switchCPR() {
  recordEvent("CPR 換人");
  setTimeout(() => alert("2分鐘已到，請考慮 CPR 換人"), 120000);
}
function giveEpinephrine() {
  alert("1mg IVP");
  recordEvent("Epinephrine 給藥");
  document.getElementById("epiCount").innerText = ++epiCount;
}
function giveAmiodarone() {
  if (++amioCount === 1) {
    alert("300mg IVP (考慮Lidocaine?)");
    recordEvent("Amiodarone 300mg 給藥");
  } else if (amioCount === 2) {
    alert("150mg IVP");
    recordEvent("Amiodarone 150mg 給藥");
    const btn = document.getElementById("amioBtn");
    btn.disabled = true;
    btn.style.opacity = 0.5;
  }
  document.getElementById("amioCount").innerText = amioCount;
}
function giveLidocaine() {
  if (++lidoCount === 1) {
    alert("1-1.5mg/kg IVP");
    recordEvent("Lidocaine 初劑量");
  } else if (lidoCount === 2) {
    alert("0.5-0.75mg/kg IVP");
    recordEvent("Lidocaine 維持劑量");
    const btn = document.getElementById("lidoBtn");
    btn.disabled = true;
    btn.style.opacity = 0.5;
  }
  document.getElementById("lidoCount").innerText = lidoCount;
}
function recordShock() {
  recordEvent("Shock!");
  document.getElementById("shockCount").innerText = ++shockCount;
}
function recordEndoTube() {
  const cm = prompt("確認 Fix\n請輸入數值（19-23cm）或取消：", "20");
  if (cm && ["19","20","21","22","23"].includes(cm)) {
    recordEvent(`Fix ${cm}cm`);
  }
}
function resetLog() {
  if (confirm("確定要清除所有紀錄？")) {
    document.getElementById("log").innerText = "";
    epiCount = amioCount = lidoCount = shockCount = 0;
    ["epiCount", "amioCount", "lidoCount", "shockCount"].forEach(id => document.getElementById(id).innerText = "0");
    document.getElementById("amioBtn").disabled = false;
    document.getElementById("amioBtn").style.opacity = 1;
    document.getElementById("lidoBtn").disabled = false;
    document.getElementById("lidoBtn").style.opacity = 1;
    startTime = null;
    timers.forEach(t => clearTimeout(t) || clearInterval(t));
    timers = [];
  }
}
function toggleGender(selected) {
  const maleBtn = document.getElementById("maleBtn");
  const femaleBtn = document.getElementById("femaleBtn");
  if (selected === 'male') {
    if (maleBtn.classList.contains('selected')) {
      maleBtn.classList.remove('selected');
    } else {
      maleBtn.classList.add('selected');
      femaleBtn.classList.remove('selected');
    }
  } else {
    if (femaleBtn.classList.contains('selected')) {
      femaleBtn.classList.remove('selected');
    } else {
      femaleBtn.classList.add('selected');
      maleBtn.classList.remove('selected');
    }
  }
}
</script>

</body>
</html>
