<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ACLS Timer Tool</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      display: flex; flex-direction: column; align-items: center;
    }
    .center-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
      gap: 10px;
      width: 100%;
    }
    .split-row {
      display: flex;
      justify-content: center;
      gap: 40px;
      width: 100%;
    }
    .column {
      width: 45%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    button {
      padding: 6px 10px;
      font-size: 13px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      max-width: 160px;
    }
    .selected { background-color: black !important; color: white !important; }
    .red { background-color: #e53935; color: white; }
    .darkred { background-color: #8B0000; color: white; }
    .yellow { background-color: #fbc02d; color: black; }
    .green { background-color: #40e0d0; color: black; }
    .blue { background-color: #4fc3f7; color: black; }
    .gray { background-color: #b0bec5; color: black; }
    .shoke { background-color: #e53935; color: yellow; font-weight: bold; }
    .brown { background-color: #d2b48c; color: black; }
    .orange { background-color: orange; color: black; }
    .toggled { background-color: #555 !important; color: white !important; text-decoration: line-through; }
    .input-label { font-size: 16px; margin-left: 10px; }
    #log {
      margin-top: 20px;
      white-space: pre-line;
      border-top: 1px solid #ccc;
      padding-top: 10px;
      width: 100%;
      max-width: 1000px;
      text-align: left;
    }
    #countInfo, #clock {
      font-size: 18px;
      color: #333;
    }
    .header-text {
      font-size: 32px;
      background-color: #e53935;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      text-align: center;
    }
  </style>
</head>
<body>

<!-- 標題與時間 -->
<div class="center-row"><div class="header-text">ACLS Timer Tool</div></div>
<div class="center-row"><div id="clock"></div></div>

<!-- 性別與年齡 -->
<div class="center-row">
  <button class="gray" id="maleBtn" onclick="toggleGender('male')">Male</button>
  <button class="gray" id="femaleBtn" onclick="toggleGender('female')">Female</button>
  <input type="number" id="ageInput" style="width:60px;" />
  <span class="input-label">Y</span>
</div>

<!-- 病史與過敏史輸入 -->
<div class="center-row" style="flex-direction: column; align-items: flex-start; width: 100%; max-width: 600px;">
  <label for="history" style="font-weight: bold; margin-bottom: 5px;">病史、過敏史</label>
  <textarea id="history" rows="3" style="width: 100%; font-size: 14px; padding: 6px;"></textarea>
</div>

<!-- 給藥與電擊次數紀錄 -->
<div class="center-row" id="countInfo" style="flex-direction: column; align-items: flex-start;">
  <div>Epinephrine: <span id="epiCount">0</span></div>
  <div>Amiodarone: <span id="amioCount">0</span></div>
  <div>Lidocaine: <span id="lidoCount">0</span></div>
  <div>Shock: <span id="shockCount">0</span></div>
</div>

<!-- 其他處置輸入 -->
<div class="center-row" style="flex-direction: column; align-items: flex-start; width: 100%; max-width: 600px;">
  <label for="otherNotes" style="font-weight: bold; margin-top: 10px; margin-bottom: 5px;">其他處置</label>
  <textarea id="otherNotes" rows="3" style="width: 100%; font-size: 14px; padding: 6px;"></textarea>
</div>

<!-- 操作按鈕與5H5T -->
<div class="split-row">
  <div class="column">
    <button class="red" onclick="startCPR()">CPR</button>
    <button class="red" onclick="aedAnalyze()">AED Analyze</button>
    <button class="red" onclick="switchCPR()">Switch CPR</button>
    <button class="shoke" onclick="recordShock()">⚡️Shock⚡️</button>
    <button class="darkred" onclick="stopCPR()">Stop CPR</button>
    <button class="yellow" onclick="giveEpinephrine()">Epi</button>
    <button class="yellow" id="amioBtn" onclick="giveAmiodarone()">Amio</button>
    <button class="yellow" id="lidoBtn" onclick="giveLidocaine()">Lido</button>
    <button class="green" onclick="recordEvent('IV')">IV</button>
    <button class="green" onclick="recordEvent('IO')">IO</button>
    <button class="green" onclick="recordEndoTube()">Endo</button>
  </div>
  <div class="column">
    <button class="brown" onclick="toggleMarker(this)">Hypoxia</button>
    <button class="brown" onclick="toggleMarker(this)">Hypo/Hyperkalemia</button>
    <button class="brown" onclick="toggleMarker(this)">Hydrogen</button>
    <button class="brown" onclick="toggleMarker(this)">Hypovolemia</button>
    <button class="brown" onclick="toggleMarker(this)">Hypothermia</button>
    <button class="orange" onclick="toggleMarker(this)">Tension pneumothorax</button>
    <button class="orange" onclick="toggleMarker(this)">Tamponade</button>
    <button class="orange" onclick="toggleMarker(this)">Toxins</button>
    <button class="orange" onclick="toggleMarker(this)">Thrombosis/Coronary</button>
    <button class="orange" onclick="toggleMarker(this)">Thrombosis/Pulmonary</button>
  </div>
</div>

<!-- ROSC 與 Reset 按鈕 -->
<div>
  <div class="center-row">
    <div style="width: 45%; display: flex; justify-content: center;">
      <button class="blue" onclick="recordEvent('ROSC')">ROSC</button>
    </div>
    <div style="width: 45%; display: flex; justify-content: center;">
    <button class="gray" onclick="resetLog()">Reset</button>
    </div>
  </div>
</div>  

<!-- 紀錄區 -->
<div id="log"></div>

<script>
let startTime = null;
let epiCount = 0, amioCount = 0, lidoCount = 0, shockCount = 0;
let timers = [];

function updateClock() {
  document.getElementById("clock").innerText = "當前時間：" + new Date().toLocaleString();
}
setInterval(updateClock, 1000); updateClock();

function recordEvent(event) {
  const now = new Date();
  if (!startTime) startTime = now;
  const elapsed = Math.floor((now - startTime) / 1000);
  document.getElementById("log").innerText +=
    `[${Math.floor(elapsed/60).toString().padStart(2,'0')}:${(elapsed%60).toString().padStart(2,'0')}] [${now.toLocaleTimeString()}] ${event}\n`;
}

function startCPR() {
  recordEvent("CPR 開始");
  if (!startTime) startTime = new Date();
  timers.push(setTimeout(() => alert("30秒心律分析"), 90000));
  timers.push(setTimeout(() => alert("10秒心律分析"), 110000));
  timers.push(setInterval(() => alert("提醒：CPR 執行中，請考慮 5H5T？"), 120000));
}
function stopCPR() {
  recordEvent("CPR 停止");
  timers.forEach(t => clearTimeout(t) || clearInterval(t));
  timers = [];
}
function aedAnalyze() {
  recordEvent("AED 分析開始（倒數 10 秒）");
  setTimeout(() => recordEvent("AED 分析結束"), 10000);
}
function switchCPR() {
  recordEvent("CPR 換人");
  setTimeout(() => alert("2分鐘已到，請考慮 CPR 換人"), 120000);
}
function giveEpinephrine() {
  alert("1mg IVP");
  recordEvent("Epinephrine 給藥");
  document.getElementById("epiCount").innerText = ++epiCount;
}
function giveAmiodarone() {
  if (++amioCount === 1) {
    alert("300mg IVP (考慮Lidocaine?)");
    recordEvent("Amiodarone 300mg 給藥");
  } else if (amioCount === 2) {
    alert("150mg IVP");
    recordEvent("Amiodarone 150mg 給藥");
    const btn = document.getElementById("amioBtn");
    btn.disabled = true;
    btn.style.opacity = 0.5;
  }
  document.getElementById("amioCount").innerText = amioCount;
}
function giveLidocaine() {
  if (++lidoCount === 1) {
    alert("1-1.5mg/kg IVP");
    recordEvent("Lidocaine 初劑量");
  } else if (lidoCount === 2) {
    alert("0.5-0.75mg/kg IVP");
    recordEvent("Lidocaine 維持劑量");
    const btn = document.getElementById("lidoBtn");
    btn.disabled = true;
    btn.style.opacity = 0.5;
  }
  document.getElementById("lidoCount").innerText = lidoCount;
}
function recordShock() {
  recordEvent("Shock!");
  document.getElementById("shockCount").innerText = ++shockCount;
}
function recordEndoTube() {
  const cm = prompt("確認 Fix\n請輸入數值（19-23cm）或取消：", "20");
  if (cm && ["19","20","21","22","23"].includes(cm)) {
    recordEvent(`Fix ${cm}cm`);
  }
}
function resetLog() {
  if (confirm("確定要清除所有紀錄？")) {
    document.getElementById("log").innerText = "";
    epiCount = amioCount = lidoCount = shockCount = 0;
    ["epiCount", "amioCount", "lidoCount", "shockCount"].forEach(id => document.getElementById(id).innerText = "0");
    ["amioBtn", "lidoBtn"].forEach(id => {
      const btn = document.getElementById(id);
      btn.disabled = false;
      btn.style.opacity = 1;
    });
    startTime = null;
    timers.forEach(t => clearTimeout(t) || clearInterval(t));
    timers = [];
    document.querySelectorAll('.toggled').forEach(btn => btn.classList.remove('toggled'));
  }
}
function toggleGender(selected) {
  const maleBtn = document.getElementById("maleBtn");
  const femaleBtn = document.getElementById("femaleBtn");
  if (selected === 'male') {
    maleBtn.classList.toggle('selected');
    femaleBtn.classList.remove('selected');
  } else {
    femaleBtn.classList.toggle('selected');
    maleBtn.classList.remove('selected');
  }
}
function toggleMarker(btn) {
  btn.classList.toggle('toggled');
}
</script>

</body>
</html>
